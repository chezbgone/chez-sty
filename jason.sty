\ProvidesPackage{jason}[2017/08/18]
\usepackage{amsmath,amssymb,amsthm}

% We include "jason" in all of these to make sure
% that they do not conflict with any other packages
\newif\ifjasonarticle \jasonarticletrue
\newif\ifjasonbeamer  \jasonbeamerfalse
\DeclareOption{beamer}{\jasonarticlefalse\jasonbeamertrue}

\newif\ifjasonsetup   \jasonsetuptrue
\newif\ifjasonshorts  \jasonshortstrue
\newif\ifjasonasy     \jasonasytrue
	\newif\ifjasonasypredef \jasonasypredeftrue
\newif\ifjasonauthor  \jasonauthortrue
\newif\ifjasondate    \jasondatetrue
\newif\ifjasoncolor   \jasoncolortrue
\newif\ifjasonthm     \jasonthmtrue

\DeclareOption{nosetup}{\jasonasyfalse}
\DeclareOption{noshortcuts}{\jasonshortsfalse}
\DeclareOption{noasy}{\jasonasyfalse}
\DeclareOption{noasypredef}{\jasonasypredeffalse}
\DeclareOption{noauthor}{\jasonauthorfalse}
\DeclareOption{nodate}{\jasondatefalse}
\DeclareOption{nocolor}{\jasoncolorfalse}
\DeclareOption{nothms}{\jasonthmfalse}

% ARTICLE
\newif\ifjasonmargins   \jasonmarginstrue
\newif\ifjasonspacing   \jasonspacingtrue
\newif\ifjasonfont      \jasonfonttrue
\newif\ifjasontitling   \jasontitlingtrue
\newif\ifjasonfancy     \jasonfancytrue
\newif\ifjasonheadrule  \jasonheadruletrue
\newif\ifjasonsectthms  \jasonsectthmsfalse
\newif\ifjasonboxedthms \jasonboxedthmstrue
\newif\ifjasonref       \jasonreftrue
\newif\ifjasoncode      \jasoncodefalse

\DeclareOption{normalmargins}{\jasonmarginsfalse}
\DeclareOption{normalspacing}{\jasonspacingfalse}
\DeclareOption{normalfont}{\jasonfontfalse}
\DeclareOption{normaltitling}{\jasontitlingfalse}
\DeclareOption{nofancy}{\jasonfancyfalse}
\DeclareOption{noheadrule}{\jasonheadrulefalse}
\DeclareOption{sectthms}{\jasonsectthmstrue}
\DeclareOption{regularthms}{\jasonboxedthmsfalse}
\DeclareOption{noref}{\jasonreffalse}
\DeclareOption{href}{\jasonhreftrue}
\DeclareOption{listings}{\jasoncodetrue}

% BEAMER
\newif\ifjasonbeamernobutton \jasonbeamernobuttontrue
\newif\ifjasonbeamernice     \jasonbeamernicetrue
\newif\ifjasonallsmallcaps   \jasonallsmallcapstrue

\DeclareOption{buttons}{\jasonbeamernobuttonfalse}
\DeclareOption{nobeamernice}{\jasonbeamernicefalse}
\DeclareOption{noallsmallcaps}{\jasonallsmallcapsfalse}

\ProcessOptions\relax

\ifjasonshorts
	% Symbols
	\newcommand{\eps}{\varepsilon}
	\newcommand{\dang}{\measuredangle} % Directed angle
	\newcommand{\dg}{\ensuremath{^\circ}}
	\newcommand{\half}{\ensuremath{\frac{1}{2}}}
	\newcommand{\st}{\; \middle\vert \;}
	\newcommand{\divides}{\; \middle\vert \;}
	\newcommand{\iso}{\cong} % Isomorphic
	
	% Arguments
	\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
	\newcommand{\ol}[1]{\overline{#1}}
	\newcommand{\ul}[1]{\underline{#1}}
	\newcommand{\ray}[1]{\overrightarrow{#1}}
	
	% Operators
	\DeclareMathOperator{\cis}{cis}
	\DeclareMathOperator{\lcm}{lcm}
	\DeclareMathOperator*{\argmax}{argmax}
	\DeclareMathOperator*{\argmin}{argmin}
	\newcommand{\Mod}[1]{\ (\text{mod}\ #1)}
	\renewcommand{\mod}[1]{\ \text{mod}\ #1}
	\renewcommand{\Re}{\operatorname{Re}}
	\renewcommand{\Im}{\operatorname{Im}}
	
	% Commands
	\newcommand{\vocab}[1]{\textbf{\color{blue}\boldmath #1}}
	\newcommand{\NewPage}{\vfill\eject}

	% Sets
	\def\FF{\mathbb F}
	\def\NN{\mathbb N}
	\def\ZZ{\mathbb Z}
	\def\QQ{\mathbb Q}
	\def\RR{\mathbb R}
	\def\CC{\mathbb C}
	\def\HH{\mathbb H}
	
	% Inequalities
	\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
	\newcommand{\symsum}{\sum_{\mathrm{sym}}}
	\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
	\newcommand{\symprod}{\prod_{\mathrm{sym}}}
	
	% for delimiters
	\usepackage{mathtools}
	
	% syntactically-named delimiters
	\DeclarePairedDelimiter{\braces}{\{}{\}}
	\DeclarePairedDelimiter{\parens}{(}{)}
	\DeclarePairedDelimiter{\brackets}{[}{]}
	\DeclarePairedDelimiter{\angles}{\langle}{\rangle}
	\DeclarePairedDelimiter{\verts}{\lvert}{\rvert}
	\DeclarePairedDelimiter{\Verts}{\lVert}{\rVert}
	\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
	\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
	\DeclarePairedDelimiter{\dnothing}{.}{.}
	
	% semantically-named delimiters
	\newcommand{\set}{\braces}
	\newcommand{\abs}{\verts}
	\newcommand{\size}{\verts}
	\newcommand{\norm}{\Verts}
	\newcommand{\tuple}{\angles}

	% Calculus
	\newcommand{\pdv}[2]{\frac{\partial #1}{\partial #2}}
	\newcommand{\pddv}[2]{\frac{\partial^2 #1}{\partial #2^2}}
	\newcommand{\pdnv}[3]{\frac{\partial^#3 #1}{\partial #2^#3}}
	
	% Stats
	\newcommand{\EE}{\mathbb E}
	\newcommand{\PP}{\mathbb P}
	\DeclareMathOperator{\Var}{Var}
\fi

% Asymptote
\ifjasonasy
	\PassOptionsToPackage{noplaybutton}{media9}
	\usepackage[inline]{asymptote}
\fi

\ifjasonsetup
% % % % % % % % % % % % % % % % % % % % % % %
% % % % % % % % % % GLOBAL % % % % % % % % % %
% % % % % % % % % % % % % % % % % % % % % % %
\usepackage{mathrsfs}
\usepackage[T1]{fontenc}
\usepackage{lmodern}

\PassOptionsToPackage{svgnames, dvipsnames}{xcolor}
\usepackage{microtype}
\usepackage{nccmath}
\usepackage{graphicx}
\usepackage{etoolbox}
\usepackage{adjustbox}

% makes \oint circle smaller
\let\oldoint\ointop
\usepackage{esint}
\renewcommand{\oint}{\oldoint\nolimits}

% Set up Author
\ifjasonauthor
	\author{Jason Chen}
\fi

% % % % % % % % % % % % % % % % % % % % % % % %
% % % % % % % % % % ARTICLE % % % % % % % % % %
% % % % % % % % % % % % % % % % % % % % % % % %
\ifjasonarticle
	\usepackage{endnotes}
	\usepackage{float}
	\usepackage[obeyFinal, textsize=scriptsize]{todonotes}
	
	% must stay in this order:
	\ifjasonref
		\usepackage{hyperref}
		\usepackage{cleveref}
	\fi
	
	\newenvironment{solution}{\begin{proof}[Solution]}{\end{proof}}
	
	\ifjasonmargins
		\PassOptionsToPackage{margin=1in}{geometry}
	\fi
	\usepackage{geometry}
	
	\usepackage{sectsty} % \allsectionsfont
	\usepackage{enumitem}
	\usepackage{titlesec} % titlespacing
	\usepackage{titling}

	% Section number before left margin
	\titleformat{\section}[hang]
		{\Large\bfseries\sffamily\boldmath}
		{\llap{\thesection\hskip 9pt}}
		{0pt}
		{}
	\titleformat{name=\section, numberless}[hang]
		{\Large\bfseries\sffamily\boldmath}
		{}
		{0em}
		{}
	
	\titleformat{\subsection}[hang]
		{\large\bfseries\sffamily\boldmath}
		{\llap{\thesubsection\hskip 9pt}}
		{0pt}
		{}
	\titleformat{name=\subsection, numberless}[hang]
		{\large\bfseries\sffamily\boldmath}
		{}
		{0em}
		{}

	\titleformat{\subsubsection}[hang]
		{\large\bfseries\sffamily\boldmath}
		{\llap{\thesubsubsection\hskip 9pt}}
		{0pt}
		{}
	\titleformat{name=\subsubsection, numberless}[hang]
		{\large\bfseries\sffamily\boldmath}
		{}
		{0em}
		{}

	% Sans Serif Headings
	\ifjasonfont
		\allsectionsfont{\sffamily\boldmath}
	\fi

	\ifjasonspacing
		\usepackage[nodisplayskipstretch, onehalfspacing]{setspace}
		
		\titlespacing{\paragraph}{0pt}{0.3em}{0.5em}
		
		\allowdisplaybreaks
		
		%\let\oldcases\cases
		%\let\oldendcases\endcases
		%\renewenvironment{cases}{\setstretch{1}\oldcases}{\oldendcases}
		\AtBeginDocument{
			\setlength{\belowdisplayskip}{5pt}
			\setlength{\belowdisplayshortskip}{2pt}
			\setlength{\abovedisplayskip}{5pt}
			\setlength{\abovedisplayshortskip}{2pt}
		}
		
		\setitemize{itemsep=0pt, topsep=0pt}
		\renewcommand\labelitemi{\raisebox{1.5pt}{\tiny$\bullet$}}
		\renewcommand{\arraystretch}{0.8}
	\fi
	
	%Titling
	\ifjasontitling
		\ifjasonfont
			\pretitle{
				\vspace{-30pt}
				\begin{center}
					\Large
					\bfseries\boldmath
					\ifjasonfont \sffamily \fi
			}
		\fi
		\posttitle{\\ \vspace{-0.1em}\end{center}}
		
		\preauthor{\begin{center} \scshape}
		\postauthor{\\ \vspace{-0.2em} \end{center}}
		
		\predate{\begin{center} \small}
		\postdate{\\ \end{center}}
		
		\providecommand{\thesubtitle}{}
		\newcommand{\subtitle}[1]{
			\renewcommand{\thesubtitle}{#1}
			\posttitle{
				\\ \vspace{0pt}
				\end{center}
				\begin{center}
					\vspace{-0.8em}
					\large
					\bfseries
					\ifjasonfont \sffamily \fi
					\thesubtitle
				\end{center}
				\vspace{-1.5em}
			}
		}
		
		\ifjasonauthor
			\author{Jason Chen}
		\fi
		
		\ifjasondate\else
			\date{~\vspace{-5ex}}
		\fi
	\fi
	
	\ifjasonfancy
		\usepackage{fancyhdr}
		\pagestyle{fancy}
		\setlength{\headheight}{36pt}
		
		% Setup Fancy Headers
		\ifjasonheadrule
			\renewcommand{\headrulewidth}{0.5pt}
		\else
			\renewcommand{\headrulewidth}{0pt}
		\fi
		\renewcommand{\footrulewidth}{0pt}
		
		\ifjasontitling
			\lhead{\theauthor}
		\fi
		
		\chead{}
		\rhead{\nouppercase{\leftmark}}
		\lfoot{}
		\cfoot{\thepage}
		\rfoot{}
	\fi
	
	\ifjasonboxedthms
		\usepackage{xcolor}
		\usepackage{thmtools}
		\usepackage[framemethod=TikZ]{mdframed}
		
		\ifjasoncolor
			\mdfdefinestyle{mdbluebox}{%
				roundcorner = 2pt,
				linewidth=1pt,
				innerbottommargin=9pt,
				nobreak=false,
				linecolor=Blue,
				backgroundcolor=DodgerBlue!5,
			}
			\declaretheoremstyle[
				headfont=\sffamily\bfseries\color{MediumBlue},
				mdframed={style=mdbluebox},
				headpunct={\\[3pt]},
				postheadspace={0pt}
			]{thmbluebox}
 	
			\mdfdefinestyle{mdrecbox}{%
				roundcorner = 2pt,
				linewidth=0.5pt,
				frametitleaboveskip=5pt,
				frametitlebelowskip=0pt,
				frametitlefont=\bfseries,
				innertopmargin=4pt,
				innerbottommargin=8pt,
				linecolor=Green,
				backgroundcolor=green!5,
			}
			\declaretheoremstyle[
				headfont=\sffamily\bfseries\color{Green},
				mdframed={style=mdrecbox},
				headpunct={\\[3pt]},
				postheadspace={0pt},
				preheadhook={~\vspace{-6pt}},
			]{thmrecbox}
		\else
			\mdfdefinestyle{mdbluebox}{%
				roundcorner = 2pt,
				linewidth=1pt,
				innerbottommargin=9pt,
				nobreak=false,
				linecolor=black,
			}
			\declaretheoremstyle[
				headfont=\sffamily\bfseries,
				mdframed={style=mdbluebox},
				headpunct={\\[3pt]},
				postheadspace={0pt}
			]{thmbluebox}
			
			\mdfdefinestyle{mdrecbox}{%
				roundcorner = 2pt,
				linewidth=0.5pt,
				frametitleaboveskip=5pt,
				frametitlebelowskip=0pt,
				frametitlefont=\bfseries,
				innertopmargin=4pt,
				innerbottommargin=8pt,
				linecolor=black,
			}
			\declaretheoremstyle[
				headfont = \sffamily\bfseries,
				mdframed = {style=mdrecbox},
				headpunct = {\\[3pt]},
				postheadspace = {0pt},
				preheadhook = {~\vspace{-6pt}},
			]{thmrecbox}
		\fi
	\fi
	
	\ifjasonthm
		\theoremstyle{plain}
		
		\ifjasonboxedthms
			\ifjasonsectthms
				\declaretheorem[%
				style=thmbluebox, name=Theorem, numberwithin=section]{theorem}
			\else
				\declaretheorem[%
				style=thmbluebox, name=Theorem]{theorem}
			\fi
			\declaretheorem[style=thmbluebox, name=Lemma, sibling=theorem]{lemma}
			\declaretheorem[style=thmbluebox, name=Proposition, sibling=theorem]{proposition}
			\declaretheorem[style=thmbluebox, name=Corollary, sibling=theorem]{corollary}
			\declaretheorem[style=thmbluebox, name=Theorem, numbered=no]{theorem*}
			\declaretheorem[style=thmbluebox, name=Lemma, numbered=no]{lemma*}
			\declaretheorem[style=thmbluebox, name=Proposition, numbered=no]{proposition*}
			\declaretheorem[style=thmbluebox, name=Corollary, numbered=no]{corollary*}

			\declaretheorem[style=thmbluebox, name=Algorithm, sibling=theorem]{algorithm}
		\else
			\ifjasonsectthms
				\newtheorem{theorem}{Theorem}[section]
			\else
				\newtheorem{theorem}{Theorem}
			\fi
			\newtheorem{lemma}[theorem]{Lemma}
			\newtheorem{proposition}[theorem]{Proposition}
			\newtheorem{corollary}[theorem]{Corollary}
			\newtheorem*{theorem*}{Theorem}
			\newtheorem*{lemma*}{Lemma}
			\newtheorem*{proposition*}{Proposition}
			\newtheorem*{corollary*}{Corollary}

			\newtheorem{algorithm}[theorem]{Algorithm}
			\newtheorem*{algorithm*}{Algorithm}
		\fi
		
		% Def-style Theorems
		\theoremstyle{definition}
		
		\newtheorem{answer}[theorem]{Answer}
		\newtheorem{case}[theorem]{Case}
		\newtheorem{claim}[theorem]{Claim}
		\newtheorem{conjecture}[theorem]{Conjecture}
		\newtheorem{definition}[theorem]{Definition}
		\newtheorem{exercise}[theorem]{Exercise}
		\newtheorem{fact}[theorem]{Fact}
		\newtheorem{problem}[theorem]{Problem}
		\newtheorem{idea}[theorem]{Idea}
		\newtheorem{question}[theorem]{Question}
		
		\newtheorem*{answer*}{Answer}
		\newtheorem*{case*}{Case}
		\newtheorem*{claim*}{Claim}
		\newtheorem*{conjecture*}{Conjecture}
		\newtheorem*{definition*}{Definition}
		\newtheorem*{exercise*}{Exercise}
		\newtheorem*{fact*}{Fact}
		\newtheorem*{joke*}{Joke}
		\newtheorem*{problem*}{Problem}
		\newtheorem*{idea*}{Idea}
		\newtheorem*{question*}{Question}
		
		\ifjasonboxedthms
			\declaretheorem[style=thmrecbox, name=Example, sibling=theorem]{example}
			\declaretheorem[style=thmrecbox, name=Example, numbered=no]{example*}
		\else
			\newtheorem{example}[theorem]{Example}
			\newtheorem*{example*}{Example}
		\fi
		
		% Remark-style theorems
		%\theoremstyle{remark}
		%\newtheorem{note}[theorem]{Note} % note theorem-environment conflicts with endnotes
		%\newtheorem*{note*}{Note}
		\newtheorem{remark}[theorem]{Remark}
		\newtheorem*{remark*}{Remark}
	\fi
	
	\ifjasoncode
		\usepackage{minted}
		\usepackage{accsupp} % prevents selection of line numbers
		\let\oldfancyVerbLine\theFancyVerbLine
		\renewcommand{\theFancyVerbLine}{\BeginAccSupp{ActualText={}}\oldfancyVerbLine\EndAccSupp{}}
	\fi
\fi

% % % % % % % % % % % % % % % % % % % % % % %
% % % % % % % % % % BEAMER % % % % % % % % % %
% % % % % % % % % % % % % % % % % % % % % % %
\ifjasonbeamer
	\ifjasonbeamernobutton
		\beamertemplatenavigationsymbolsempty
	\fi
	
	\ifjasonthm
		\newtheorem{proposition}[theorem]{Proposition}
		\newtheorem{answer}[theorem]{Answer}
		\newtheorem{case}[theorem]{Case}
		\newtheorem{claim}[theorem]{Claim}
		\newtheorem{conjecture}[theorem]{Conjecture}
		\newtheorem{exercise}[theorem]{Exercise}
		\newtheorem{idea}[theorem]{Idea}
		\newtheorem{question}[theorem]{Question}
		
		\definecolor{jasondarkred}{rgb}{0.523, 0.148, 0.148}
		\definecolor{jasonpalered}{rgb}{0.949, 0.910, 0.910}
		\definecolor{jasondarkblue}{rgb}{0.148, 0.148, 0.523}
		\definecolor{jasonpaleblue}{rgb}{0.910, 0.910, 0.949}
		\definecolor{jasondarkgreen}{rgb}{0.148, 0.523, 0.148}
		\definecolor{jasonpalegreen}{rgb}{0.910, 0.949, 0.910}
		
		\AtBeginEnvironment{theorem}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{lemma}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{proposition}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{corollary}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{conjecture}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{definition}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{example}{
			\setbeamercolor{block title example}{fg=white, bg=jasondarkgreen}
			\setbeamercolor{block body example}{fg=black, bg=jasonpalegreen}
		}
		
		\AtBeginEnvironment{proof}{
			\setbeamercolor{block title}{fg=white, bg=jasondarkblue}
			\setbeamercolor{block body}{fg=black, bg=jasonpaleblue}
		}
		
		\AtBeginEnvironment{alert}{
			\setbeamercolor{block title alert}{fg=white, bg=jasondarkred}
			\setbeamercolor{block body alert}{fg=black, bg=jasonpalered}
		}
	\fi
	
	\ifjasonbeamernice
		\IfFileExists{beamerthememetropolis.sty}{
			\usepackage[sfdefault, lf]{FiraSans}
			\usetheme[block = fill]{metropolis}
			\ifjasonallsmallcaps
				\metroset{titleformat = allsmallcaps}
				\setbeamerfont{title}{size=\Large, series=\mdseries}
				\setbeamerfont{section title}{size=\Large, series=\mdseries}
				\setbeamerfont{block title}{size=\normalsize, series=\mdseries}
				\setbeamerfont{block title alerted}{size=\normalsize, series=\mdseries}
				\setbeamerfont{frametitle}{size=\large, series=\mdseries}
				\setbeamerfont{caption name}{series=\mdseries}
				\setbeamerfont{description item}{series=\mdseries}
				\setbeamerfont{standout}{size=\Large, series=\mdseries}
			\fi
		}{
			\usetheme{Rochester}
			\usecolortheme{whale}
		}
	\else
		\usetheme{Rochester}
		\usecolortheme{whale}
	\fi
\fi

\fi
