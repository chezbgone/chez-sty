\ProvidesPackage{jason}[2016/05/11]
% Heavily based off of Evan Chen's .sty
\usepackage{amsmath,amssymb,amsthm}

% We include "jason" in all of these to make sure
% that they do not conflict with any other packages
\newif\ifjasonarticle \jasonarticletrue
\newif\ifjasonbeamer  \jasonbeamerfalse
\DeclareOption{beamer}{\jasonarticlefalse\jasonbeamertrue}

\newif\ifjasonsetup   \jasonsetuptrue
\newif\ifjasonshorts  \jasonshortstrue
\newif\ifjasonasy     \jasonasytrue
	\newif\ifjasonasypredef \jasonasypredeftrue
\newif\ifjasonauthor  \jasonauthortrue
\newif\ifjasonchinese \jasonchinesefalse

\DeclareOption{nosetup}{\jasonasyfalse}
\DeclareOption{noshortcuts}{\jasonshortsfalse}
\DeclareOption{noasy}{\jasonasyfalse}
\DeclareOption{noasypredef}{\jasonasypredeffalse}
\DeclareOption{noauthor}{\jasonauthorfalse}
\DeclareOption{chinese}{\jasonchinesetrue}

% ARTICLE
\newif\ifjasonmargins   \jasonmarginstrue
\newif\ifjasonspacing   \jasonspacingtrue
\newif\ifjasonfont      \jasonfonttrue
\newif\ifjasontitling   \jasontitlingtrue
\newif\ifjasonfancy     \jasonfancytrue
\newif\ifjasonheadrule  \jasonheadruletrue
\newif\ifjasonthm       \jasonthmtrue
\newif\ifjasonsectthms  \jasonsectthmsfalse
\newif\ifjasonboxedthms \jasonboxedthmstrue
\newif\ifjasonref       \jasonreftrue
\newif\ifjasonhref      \jasonhreffalse
\newif\ifjasoncode      \jasoncodetrue

\DeclareOption{normalmargins}{\jasonmarginsfalse}
\DeclareOption{normalspacing}{\jasonspacingfalse}
\DeclareOption{normalfont}{\jasonfontfalse}
\DeclareOption{normaltitling}{\jasontitlingfalse}
\DeclareOption{nofancy}{\jasonfancyfalse}
\DeclareOption{noheadrule}{\jasonheadrulefalse}
\DeclareOption{nothms}{\jasonthmfalse}
\DeclareOption{sectthms}{\jasonsectthmstrue}
\DeclareOption{regularthms}{\jasonboxedthmsfalse}
\DeclareOption{noref}{\jasonreffalse}
\DeclareOption{href}{\jasonhreftrue}
\DeclareOption{nocode}{\jasoncodefalse}

% BEAMER
\newif\ifjasonbeamernobutton  \jasonbeamernobuttonfalse
\newif\ifjasonbeamersimple    \jasonbeamersimplefalse

\DeclareOption{nobuttons}{\jasonbeamernobuttontrue}
\DeclareOption{simple}{\jasonbeamersimpletrue}

\ProcessOptions\relax

\ifjasonshorts
	% Symbols
	\newcommand{\eps}{\varepsilon}
	\newcommand{\dang}{\measuredangle} %% Directed angle
	%\renewcommand{\iff}{\Leftrightarrow}
	%\renewcommand{\implies}{\Rightarrow}
	\def\dg{^\circ}
	\def\ii{\item}
	\def\half{\frac{1}{2}}
	
	% Arguments
	\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
	\newcommand{\ol}[1]{\overline{#1}}
	\newcommand{\ul}[1]{\underline{#1}}
	\newcommand{\ray}[1]{\overrightarrow{#1}}
	\newcommand{\seg}[1]{\ol{#1}}
	\newcommand{\arc}[1]{\wideparen{#1}}
	\newcommand{\vocab}[1]{\textbf{\color{blue} #1}}
	\newcommand{\hrulebar}{
		\par\hspace{\fill}\rule{0.95\linewidth}{.7pt}\hspace{\fill}
		\par\nointerlineskip \vspace{\baselineskip}
	}
	
	% Operators
	\DeclareMathOperator{\cis}{cis}
	\DeclareMathOperator{\lcm}{lcm}
	\newcommand{\Mod}[1]{\ (\text{mod}\ #1)}
	\renewcommand{\mod}[1]{\ \text{mod}\ #1}
	
	% Commands
	\newcommand{\NewPage}{\vfill\eject}
	\newcommand{\supnewline}{\leavevmode\par\vspace*{\dimexpr-3pt-\parskip-\baselineskip}}
	
	% Sets
	\def\CC{\mathbb C}
	\def\FF{\mathbb F}
	\def\NN{\mathbb N}
	\def\QQ{\mathbb Q}
	\def\RR{\mathbb R}
	\def\ZZ{\mathbb Z}
	
	% Inequalities
	\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
	\newcommand{\symsum}{\sum_{\mathrm{sym}}}
	\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
	\newcommand{\symprod}{\prod_{\mathrm{sym}}}
	
	% syntactically named delimiters
	\newcommand{\braces}[1]{\left\lbrace #1 \right\rbrace}
	\newcommand{\angles}[1]{\left\langle #1 \right\rangle}
	\newcommand{\verts}[1]{\left\lvert #1 \right\rvert}
	\newcommand{\Verts}[1]{\left\lVert #1 \right\rVert}
	\newcommand{\brackets}[1]{\left[ #1 \right]}
	\newcommand{\parens}[1]{\left( #1 \right)}
	\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
	\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
	
	% semantically named delimiters
	\newcommand{\set}{\braces}
	\newcommand{\abs}{\verts}
	\newcommand{\size}{\verts}
	\newcommand{\norm}{\Verts}
	\newcommand{\tuple}{\angles}
\fi

% Asymptote
\ifjasonasy
	\PassOptionsToPackage{noplaybutton}{media9}
	\usepackage[inline]{asymptote}

	\begin{asydef}
		import olympiad; import cse5;
		pointpen = pathpen = pathfontpen = anglepen = anglefontpen = black;
		pointfontsize = 9; defaultpen(fontsize(9pt));
		usepackage("amsmath"); usepackage("amssymb");
		size(7cm);
		
		pen n_purple = rgb(0.7,0.4,1),
			n_blue = rgb(0,0.6,1),
			n_green = rgb(0,0.4,0),
			n_orange = rgb(1,0.4,0.1),
			n_red = rgb(1,0.2,0.4);
		
		pair bary(real a, real b, real c, pair X, pair Y, pair Z){
			return (a*X + b*Y + c*Z)/(a + b + c);
		}
		
		pair excenter(pair A, pair B, pair C){
			return bary(-d(B,C), d(C,A), d(A,B), A, B, C);
		}
		
		path excircle(pair A, pair B, pair C){
			return CP(excenter(A,B,C),foot(excenter(A,B,C),B,C));
		}
		
		pair A = dir(110), B = dir(210), C = dir(330), D = dir(20),
		O = origin, H = orthocenter(A,B,C), I = incenter(A,B,C);
	\end{asydef}
\fi

\ifjasonsetup
% % % % % % % % % % % % % % % % % % % % % % %
% % % % % % % % % % GLOBAL % % % % % % % % % %
% % % % % % % % % % % % % % % % % % % % % % %
\PassOptionsToPackage{svgnames,dvipsnames}{xcolor}
\usepackage{microtype}
\usepackage{mathtools}
\usepackage{nccmath}
\usepackage{graphicx}
\usepackage{endnotes}
\usepackage{float}
\usepackage[obeyFinal,textsize=scriptsize]{todonotes}

% Set up Author
\ifjasonauthor
	\AtBeginDocument{
		\author{Jason Chen}
	}
\fi

\ifjasonchinese
	\usepackage[encapsulated]{CJK}
	\usepackage{ucs}
	\usepackage[utf8x]{inputenc}
	\newenvironment{bsmi}{\begin{CJK}{UTF8}{bsmi}}{\end{CJK}}
	\newcommand{\cn}[1]{\begin{bsmi}#1\end{bsmi}}
	\AtBeginDocument{\begin{CJK}{UTF8}{bsmi}}
		\AtEndDocument{\end{CJK}}
\fi

% % % % % % % % % % % % % % % % % % % % % % % %
% % % % % % % % % % ARTICLE % % % % % % % % % %
% % % % % % % % % % % % % % % % % % % % % % % %
\ifjasonarticle
	% must stay in this order:
	\ifjasonref
		\ifjasonhref
			\usepackage{hyperref}
		\else
			\usepackage[nameinlink]{cleveref}
		\fi
	\fi
	
	\newenvironment{solution}{\begin{proof}[Solution]}{\end{proof}}
	
	\ifjasonmargins
		\PassOptionsToPackage{margin=2.5cm}{geometry}
	\fi
	\usepackage{geometry}
	
	\usepackage{enumitem} % \setitemize
	\ifjasonspacing
		\usepackage[nodisplayskipstretch,onehalfspacing]{setspace}
		
		%\let\oldcases\cases
		%\let\oldendcases\endcases
		%\renewenvironment{cases}{\setstretch{1}\oldcases}{\oldendcases}
		\AtBeginDocument{
			\setlength{\belowdisplayskip}{5pt}
			\setlength{\belowdisplayshortskip}{2pt}
			\setlength{\abovedisplayskip}{5pt}
			\setlength{\abovedisplayshortskip}{2pt}
		}
		
		\setitemize{itemsep=0pt}
		\renewcommand\labelitemi{\raisebox{1.5pt}{\tiny$\bullet$}}
	\fi
	
	% Sans Serif Headings
	\usepackage{sectsty} % \allsectionsfont
	\ifjasonfont
		\allsectionsfont{\sffamily}
	\fi
	
	%Titling
	\ifjasontitling
		\usepackage{titling}
		
		\newcommand{\thesubtitle}{}
		\providecommand{\subtitle}{}
		
		\renewcommand{\subtitle}[1]{%
		\renewcommand{\thesubtitle}{#1}
		\posttitle{\\ {\normalsize \thesubtitle} \end{center}\vspace{\posttitledrop}}}
		\newlength{\posttitledrop}
		\setlength{\posttitledrop}{-0.7em}
		\newlength{\postauthordrop}
		\setlength{\postauthordrop}{-1.2em}
		\pretitle{\vspace{-20pt}\begin{center}\bfseries \ifjasonfont\sffamily\fi \Large}
		\posttitle{\end{center}\vspace{\posttitledrop}}
		\preauthor{\begin{center} \scshape}
		\postauthor{\end{center}\vspace{\postauthordrop}}
		\predate{\begin{center}\small}
		\postdate{\end{center}
	}
	\fi

	\ifjasonfancy
		\usepackage{fancyhdr}
		\pagestyle{fancy}
		\setlength{\headheight}{36pt}
		
		% Setup Fancy Headers
		\ifjasonheadrule
			\renewcommand{\headrulewidth}{0.5pt}
		\else
			\renewcommand{\headrulewidth}{0pt}
		\fi
		\renewcommand{\footrulewidth}{0pt}
		
		\ifjasontitling
			\lhead{\theauthor}
		\fi
		
		\chead{}
		\rhead{\nouppercase{\leftmark}}
		\lfoot{}
		\cfoot{\thepage}
		\rfoot{}
	\fi
	
	\ifjasonboxedthms
		\usepackage{xcolor}
		\usepackage{thmtools}
		\usepackage[framemethod=TikZ]{mdframed}
		
		\mdfdefinestyle{mdbluebox}{%
			roundcorner = 5pt,
			linewidth=1pt,
			skipabove=10pt,
			innerbottommargin=9pt,
			skipbelow=2pt,
			linecolor=blue,
			backgroundcolor=TealBlue!5,
		}
		\declaretheoremstyle[
			headfont=\sffamily\bfseries\color{MidnightBlue},
			mdframed={style=mdbluebox},
			headpunct={\\[3pt]},
			postheadspace={0pt}
		]{thmbluebox}

		\mdfdefinestyle{mdrecbox}{%
			linewidth=0.5pt,
			skipabove=12pt,
			frametitleaboveskip=5pt,
			frametitlebelowskip=0pt,
			skipbelow=2pt,
			frametitlefont=\bfseries,
			innertopmargin=4pt,
			innerbottommargin=8pt,
			backgroundcolor=Salmon!5,
		}
		\declaretheoremstyle[
			headfont=\bfseries\color{RawSienna},
			mdframed={style=mdrecbox},
			headpunct={\\[3pt]},
			postheadspace={0pt},
		]{thmrecbox}
	\fi
	
	\ifjasonthm
		\theoremstyle{plain}
		
		\ifjasonboxedthms
			\ifjasonsectthms
				\declaretheorem[%
				style=thmbluebox,name=Theorem,numberwithin=section]{theorem}
			\else
				\declaretheorem[%
				style=thmbluebox,name=Theorem]{theorem}
			\fi
			\declaretheorem[style=thmbluebox,name=Lemma,sibling=theorem]{lemma}
			\declaretheorem[style=thmbluebox,name=Proposition,sibling=theorem]{proposition}
			\declaretheorem[style=thmbluebox,name=Corollary,sibling=theorem]{corollary}
			\declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{theorem*}
			\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
			\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{proposition*}
			\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{corollary*}
		\else
			\ifjasonsectthms
				\newtheorem{theorem}{Theorem}[section]
			\else
				\newtheorem{theorem}{Theorem}
			\fi
			\newtheorem{lemma}[theorem]{Lemma}
			\newtheorem{proposition}[theorem]{Proposition}
			\newtheorem{corollary}[theorem]{Corollary}
			\newtheorem*{theorem*}{Theorem}
			\newtheorem*{lemma*}{Lemma}
			\newtheorem*{proposition*}{Proposition}
			\newtheorem*{corollary*}{Corollary}
		\fi
		
		% Def-style Theorems
		\theoremstyle{definition}
		
		\ifjasonboxedthms
			\declaretheorem[style=thmbluebox,name=Algorithm,sibling=theorem]{algorithm}
		\else
			\newtheorem{algorithm}[theorem]{Algorithm}
			\newtheorem*{algorithm*}{Algorithm}
		\fi
		
		\newtheorem{answer}[theorem]{Answer}
		\newtheorem{case}[theorem]{Case}
		\newtheorem{claim}[theorem]{Claim}
		\newtheorem{conjecture}[theorem]{Conjecture}
		\newtheorem{definition}[theorem]{Definition}
		\newtheorem{exercise}[theorem]{Exercise}
		\newtheorem{fact}[theorem]{Fact}
		\newtheorem{problem}[theorem]{Problem}
		\newtheorem{question}[theorem]{Question}
		
		\newtheorem*{answer*}{Answer}
		\newtheorem*{case*}{Case}
		\newtheorem*{claim*}{Claim}
		\newtheorem*{conjecture*}{Conjecture}
		\newtheorem*{definition*}{Definition}
		\newtheorem*{exercise*}{Exercise}
		\newtheorem*{fact*}{Fact}
		\newtheorem*{joke*}{Joke}
		\newtheorem*{problem*}{Problem}
		\newtheorem*{question*}{Question}
		
		\ifjasonboxedthms
			\declaretheorem[style=thmrecbox,name=Example,sibling=theorem]{example}
			\declaretheorem[style=thmrecbox,name=Example,numbered=no]{example*}
		\else
			\newtheorem{example}[theorem]{Example}
			\newtheorem*{example*}{Example}
		\fi
		
		% Remark-style theorems
		%\theoremstyle{remark}
		\newtheorem{note}[theorem]{Note}
		\newtheorem{remark}[theorem]{Remark}
		\newtheorem*{note*}{Note}
		\newtheorem*{remark*}{Remark}
	\fi
	
	\ifjasoncode
		\usepackage{listings}
		\usepackage{algpseudocode}
	\fi
\fi

% % % % % % % % % % % % % % % % % % % % % % %
% % % % % % % % % % BEAMER % % % % % % % % % %
% % % % % % % % % % % % % % % % % % % % % % %
\ifjasonbeamer
	\ifjasonbeamernobutton
		\beamertemplatenavigationsymbolsempty
	\fi
	
	\ifjasonbeamersimple
		\usetheme{default}
	\else
		\usetheme{Rochester}
		\usecolortheme{whale}
	\fi
\fi

\fi
